<!doctype>
<html>
	<head>
	<title>JavaScript API</title>
	<script src="js/web3.min.js" type="text/javascript"></script>
	<script src='js/jquery-2.0.3.min.js'></script>

	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js">
  <script type="text/javascript">
 /**
*  jQuery listen for clicks and interaction
*
* 1  Start ethereum with json rpc eg. eth -j --json-rpc-port 8545 -i
* edit ethereum public key below in code and add your own
* 2 Click on create example contract
* 3  on command line type   minestart
* 4  when contract is accepted to EVM blockchain, UI will be updated
* 5  on command line type   minestop
* 6  add number to input box
* 7  the click button and input number * 7 answer will be displayed
*/
$(document).ready(function(){

	var web3 = require('web3');
	web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
	// solidity code code
	var source = "" +
	"contract test {\n" +
	"   function multiply(uint a) constant returns(uint d) {\n" +
	"       return a * 7;\n" +
	"   }\n" +
	"}\n";

	var compiled = web3.eth.compile.solidity(source);
console.log(compiled);
var keye = Object.keys(compiled);
var code = compiled[keye[0]].code;
// contract json abi, this is autogenerated using solc CLI
var abi = compiled[keye[0]].info.abiDefinition;
console.log(abi);

	var myContract;
	// if clicked
	$("#createSolidityContract").click(function(e) {

		// hide create button
		$('#create').hide()
		$('#code').text(code);

		// let's assume that coinbase is our account
		web3.eth.defaultAccount = '52bddcd1897e2b7516b2218e69fda38c017c29b9'; //web3.eth.coinbase;
console.log(web3.eth.defaultAccount);
console.log(web3.eth.coinbase);

		var blockwatch = web3.eth.filter('latest');
console.log(blockwatch);

		web3.eth.contract(abi).new({data: code, gas: 200000}, function (err, contract) {

			$('#status').text("transaction sent, waiting for confirmation");
			if (err) {
console.error(err);
				return;
			}
			else if(contract.address) {
				myContract = contract;
console.log('address: ' + myContract.address);
				$('#status').text('Mined!');
				$('#call').show();

				myContract = contract;
console.log('address: ' + myContract.address);

			}



		});

	});

	// if clickeced
	$("#callExampleContract").click(function(e) {

		// this should be generated by ethereum
		var param = parseInt($('#value').val());
console.log(param);
		// call the contract
		var res = myContract.multiply(param);
console.log(res);
console.log(web3.toDecimal(res));

		$('#result').text(web3.toDecimal(res));

	});

});  // closes jquery

</script>
</head>
<body>
    <h1>contract</h1>
    <div id="code"></div>
    <div id="status" >change</div>
    <div id='create'>
        <button type="button" id="createSolidityContract">create example contract</button>
    </div>
    <div id='call' style="display: none">
        <input type="number" id="value" ></input>
	<button type="button" id="callExampleContract">use/ apply input to contract method</button>
    </div>
    <div id="result"></div>
</body>
</html>
