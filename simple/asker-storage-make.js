var Web3 = require('web3');
var fs = require('fs');

var web3 = new Web3();

web3.setProvider(new web3.providers.HttpProvider('http://localhost:8545'));

var coinbase = web3.eth.coinbase;
console.log(coinbase);
web3.eth.defaultAccount = coinbase;
var balance = web3.eth.getBalance(coinbase);
console.log(balance.toString(10));
// solidity code code
fs.readFile('smartcontracts/storageapi-contract.sol', function(err, data) {
console.log('data from solidity file');
console.log(data.toString());
  var source = data.toString();
console.log('after source');
var compiled = web3.eth.compile.solidity(source);
var keye = Object.keys(compiled);
var code = compiled[keye[0]].code;
// contract json abi, this is autogenerated using solc CLI
var abi = compiled[keye[0]].info.abiDefinition;
console.log('that abi ===');
console.log(abi);

var myContract;
//  var blockwatch = web3.eth.filter('latest');
//console.log(blockwatch);

  web3.eth.contract(abi).new({data: code, gas: 900000,}, function (err, contract) {

    if (err) {
console.error(err);
      return;
    }
    else if(contract.address) {
      myContract = contract;
console.log('address: ' + myContract.address);
       var tokensapilong = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IldVNEpmaFI3aHdjQ055VE5vMWVXUDJvU3RGWlREeklJNjExd1lZTUtQM1k9IiwiaWF0IjoxNDgwNzk2Njk3fQ.F4PYceA7MD1UAxXBiEztyoHt86J2t5beNrIt_qj176g";
        var tokensapi = "eyJhbGc";
        myContract.setToken(tokensapi);
        myContract.setSensorOwner('787878787',tokensapi);
        var returnDmap = myContract.getToken();
      console.log('Token ID =====');
      console.log(returnDmap);
      var returnmapping = myContract.getOwner('787878787');
    console.log('Token mapp =====');
    console.log(returnmapping);


    }
  });

});
